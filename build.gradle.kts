/*
 * This file was generated by the Gradle 'init' task.
 *
 * This is a general purpose Gradle build.
 * Learn more about Gradle by exploring our Samples at https://docs.gradle.org/8.13/samples
 * This project uses @Incubating APIs which are subject to change.
 */


plugins {
    id("java")
    id("jacoco")
    id("application")
    id("com.diffplug.spotless") version "7.0.3"
    id("info.solidsoft.pitest") version "1.15.0"
}

// Spotless configuration for code formatting
spotless {
    java {
        // Use Google's Java formatting style
        googleJavaFormat()
        // Remove unused imports
        importOrder()
        // Remove trailing whitespace
        trimTrailingWhitespace()
        // Ensure files end with a newline
        endWithNewline()
    }
}

application {
    mainClass.set(project.findProperty("mainClass")?.toString() ?: "com.streamConverter.Main")
}

java {
    sourceCompatibility = JavaVersion.VERSION_17
    targetCompatibility = JavaVersion.VERSION_17
}

tasks.withType<JavaCompile> {
    options.encoding = "UTF-8"
}

repositories {
    mavenCentral()
}

dependencies {
    // メインの依存関係
    implementation("org.apache.commons:commons-lang3:3.17.0")
    implementation("commons-io:commons-io:2.19.0")
    implementation("org.slf4j:slf4j-api:2.0.17")
    implementation("ch.qos.logback:logback-classic:1.5.18")

    // JUnit 5 の依存関係（テスト用）
	testImplementation(platform("org.junit:junit-bom:5.12.2"))
	testImplementation("org.junit.jupiter:junit-jupiter")
	testRuntimeOnly("org.junit.platform:junit-platform-launcher")
    testImplementation("org.pitest:pitest-junit5-plugin:1.2.2")
    
    // Mockito の依存関係（テスト用）
    testImplementation("org.mockito:mockito-core:5.11.0")
    testImplementation("org.mockito:mockito-junit-jupiter:5.11.0")
}

tasks.test {
    // JUnit 5 を使うための設定
    useJUnitPlatform()
    
    // テスト実行時の詳細ログを表示
    testLogging {
        events("passed", "skipped", "failed")
        showStandardStreams = true
    }
    
    // テスト完了後にJaCoCoレポートを生成
    finalizedBy(tasks.jacocoTestReport)
    // テスト実行後にPITレポートを生成
    finalizedBy(tasks.pitest)
    // テスト実行後にjavadocを生成
    finalizedBy(tasks.javadoc)
}

// JaCoCoレポートの設定
tasks.jacocoTestReport {
    reports {
        html.required.set(true)
    }
    
    // テスト後にレポートを生成
    dependsOn(tasks.test)
}

// PITレポートの設定
tasks.pitest {
    targetClasses.set(listOf("com.streamConverter.*")) // テスト対象のクラスを指定
    outputFormats.set(listOf("HTML")) // 出力形式を指定
    // テスト後にレポートを生成
    dependsOn(tasks.test)
}

// javadocタスクの設定
tasks.javadoc {
    options.encoding = "UTF-8"
    options.memberLevel = org.gradle.external.javadoc.JavadocMemberLevel.PROTECTED
}

// spotlessCheck タスクを無効化
tasks.named("spotlessCheck") {
    enabled = false
}

// check タスクの実行時に spotlessApply を依存タスクとして実行する
tasks.named("check") {
    dependsOn("spotlessApply")
}
